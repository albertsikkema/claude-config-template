{
  "permissions": {
    "allow": [
      "WebFetch(domain:*)",
      "Task",

      "Bash(ls *)",
      "Bash(tree *)",
      "Bash(file *)",
      "Bash(du *)",
      "Bash(wc *)",

      "Bash(pwd)",
      "Bash(which *)",
      "Bash(whoami)",
      "Bash(uname *)",
      "Bash(date *)",
      "Bash(* --version)",
      "Bash(* --help *)",

      "Bash(git status *)",
      "Bash(git log *)",
      "Bash(git diff *)",
      "Bash(git show *)",
      "Bash(git branch -a *)",
      "Bash(git branch -l *)",
      "Bash(git fetch *)",
      "Bash(git pull *)",
      "Bash(git add *)",
      "Bash(git commit *)",

      "Bash(gh pr view *)",
      "Bash(gh pr list *)",
      "Bash(gh issue view *)",
      "Bash(gh issue list *)",

      "Bash(grep *)",
      "Bash(rg *)",
      "Bash(jq *)",

      "Bash(npm run test *)",
      "Bash(npm run lint *)",
      "Bash(npm run build *)",
      "Bash(npm list *)",
      "Bash(npm outdated *)",
      "Bash(npm install *)",

      "Bash(pytest *)",
      "Bash(python -m pytest *)",

      "Bash(uv sync *)",
      "Bash(pip install *)",

      "Bash(docker ps *)",
      "Bash(docker images *)",
      "Bash(docker logs *)",
      "Bash(docker compose up *)",
      "Bash(docker compose down *)"
    ],
    "deny": [
      "Read(./.env)",
      "Read(./.env.*)",
      "Read(.envrc)",
      "Read(./secrets/**)",
      "Read(~/.aws/**)",
      "Read(~/.config/gh/*)",
      "Read(./.vault-token)",
      "Read(./.htpasswd)",
      "Read(./.pgpass)",
      "Read(./.my.cnf)",
      "Read(~/.docker/config.json)",
      "Read(./*.tfstate)",

      "Bash(cat ~/.aws/*)",
      "Bash(cat /etc/shadow)",
      "Bash(env | base64)",
      "Bash(printenv | base64)",
      "Bash(history | grep -i password*)",

      "Bash(git push *)",
      "Bash(git push --force *)",
      "Bash(git push -f *)",
      "Bash(git push --force-with-lease *)",
      "Bash(git reset --hard *)",
      "Bash(git clean -f *)",
      "Bash(git branch -D *)",
      "Bash(git checkout -- *)",

      "Bash(curl * | sh)",
      "Bash(curl * | bash)",
      "Bash(wget * | sh)",
      "Bash(wget * | bash)",
      "Bash(* | base64 -d | sh)",

      "Bash(curl http://169.254.169.254/*)",
      "Bash(wget http://169.254.169.254/*)",
      "Bash(curl http://metadata.google.internal/*)",

      "Bash(bash -i >& /dev/tcp/*)",
      "Bash(* | nc -l *)",

      "Bash(docker run --privileged *)",
      "Bash(docker run * -v /:/host *)",
      "Bash(docker run * --pid=host *)",
      "Bash(nsenter *)",

      "Bash(rm -rf *)",
      "Bash(rm /var/log/*)",
      "Bash(find / -type f -delete)",
      "Bash(find . -delete)",
      "Bash(find * -delete)",
      "Bash(truncate -s 0 /var/log/*)",

      "Bash(dd if=/dev/zero of=/dev/*)",
      "Bash(mkfs *)",

      "Bash(sudo *)",
      "Bash(chmod 777 *)",
      "Bash(chown *)",
      "Bash(shutdown *)",
      "Bash(reboot)",
      "Bash(halt)",

      "Bash(*xmrig*)",

      "Bash(terraform destroy *)",
      "Bash(terraform apply -destroy *)",
      "Bash(pulumi destroy *)",

      "Bash(aws ec2 terminate-instances *)",
      "Bash(aws rds delete-db-instance *)",
      "Bash(aws cloudformation delete-stack *)",
      "Bash(aws dynamodb delete-table *)",
      "Bash(gcloud projects delete *)",
      "Bash(gcloud compute instances delete *)",

      "Bash(kubectl delete namespace *)",
      "Bash(kubectl delete deployment *)",
      "Bash(kubectl delete -f *)",

      "Bash(* DROP TABLE *)",
      "Bash(* DROP DATABASE *)",
      "Bash(* TRUNCATE TABLE *)",
      "Bash(redis-cli FLUSHALL *)",
      "Bash(redis-cli FLUSHDB *)",
      "Bash(* dropDatabase *)",

      "Bash(docker system prune *)",
      "Bash(docker volume rm *)",

      "Bash(crontab -r *)",
      "Bash(systemctl disable *)",

      "Bash(curl -d @* *)",
      "Bash(curl -F file=@* *)",
      "Bash(curl --data-binary @* *)",
      "Bash(scp * *:*)",
      "Bash(rsync * *:*)"
    ]
  },
  "hooks": {
    "UserPromptSubmit": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "python3 \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/user_prompt_submit.py --validate",
            "timeout": 10000
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "python3 \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/pre_tool_use.py",
            "timeout": 10000
          },
          {
            "type": "prompt",
            "prompt": "You are a security gate for an AI coding assistant running in a sandboxed container. Evaluate this Bash command:\n\n$ARGUMENTS\n\nBLOCK (ok: false) if the command:\n- Exfiltrates data to external servers (curl -d, scp, rsync, nc to remote hosts)\n- Opens reverse shells or network backdoors\n- Accesses cloud metadata endpoints (169.254.169.254, metadata.google.internal)\n- Downloads and executes remote code (even via intermediate files like curl -o then sh)\n- Destroys infrastructure (terraform destroy, aws terminate, kubectl delete namespace)\n- Drops or truncates databases (DROP TABLE, TRUNCATE, FLUSHALL)\n- Mines cryptocurrency\n- Attempts container escape (nsenter, mount host filesystem)\n- Encodes and exfiltrates environment variables or credentials\n\nALLOW (ok: true) if the command is:\n- Normal development (build, test, lint, install, git operations except push)\n- File operations within the project directory\n- Reading system info, logs, or configs\n- Package management (npm, pip, uv)\n- Docker operations that don't escape the container\n- SSH connections using local keys in ~/.ssh/ (git clone, git pull, scp from known hosts, remote commands)\n\nRespond ONLY with JSON: {\"ok\": true} or {\"ok\": false, \"reason\": \"brief explanation\"}",
            "timeout": 10000
          }
        ]
      },
      {
        "matcher": "Read|Edit|Write|Glob|Grep|MultiEdit",
        "hooks": [
          {
            "type": "command",
            "command": "python3 \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/pre_tool_use.py",
            "timeout": 10000
          }
        ]
      }
    ],
    "Notification": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "python3 \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/notification.py --notify",
            "timeout": 5000
          }
        ]
      }
    ],
    "SessionStart": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "python3 \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/session_start.py --load-context",
            "timeout": 15000
          }
        ]
      }
    ],
    "SessionEnd": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "python3 \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/session_end.py --announce",
            "timeout": 15000
          }
        ]
      }
    ],
    "Stop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "python3 \"$CLAUDE_PROJECT_DIR\"/.claude/hooks/stop.py --filter-simple",
            "timeout": 10000
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "WebSearch",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/log-websearch.sh",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": "WebFetch",
        "hooks": [
          {
            "type": "command",
            "command": "\"$CLAUDE_PROJECT_DIR\"/.claude/hooks/log-webfetch.sh",
            "timeout": 5000
          }
        ]
      }
    ]
  }
}
