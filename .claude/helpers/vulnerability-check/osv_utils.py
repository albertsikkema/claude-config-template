"""Shared helpers for processing OSV vulnerability data."""


def extract_vuln_info(v: dict) -> dict:
    """Extract severity, aliases, and fix versions from an OSV vulnerability dict."""
    severity = "unknown"
    for s in v.get("severity", []):
        if s.get("type") == "CVSS_V3":
            severity = s.get("score", severity)
            break
    fix_versions = []
    for affected in v.get("affected", []):
        for r in affected.get("ranges", []):
            for ev in r.get("events", []):
                if "fixed" in ev:
                    fix_versions.append(ev["fixed"])
    return {
        "id": v.get("id", "?"),
        "summary": v.get("summary", ""),
        "severity": severity,
        "aliases": v.get("aliases", []),
        "fix_versions": fix_versions,
    }
